@page
@model IndexModel
@{
    ViewData["Title"] = "Главная";
}

@section JavaScript {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
      
    <script src="https://rawgit.com/bbecquet/Leaflet.PolylineDecorator/master/dist/leaflet.polylineDecorator.js"></script>
}

// Leaflet integration
<div id="map" class="fixed-bottom" style="width: 100%; height: calc(100% - 55px); "></div>
<script>
    // Drawing map
    var map = L.map('map').setView([59.562951, 30.130286], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // Exam roads
    var roadLines = [
        [[30.1203988,59.5635439],
        [30.1245187,59.5598044],
        [30.1275227,59.5570212],
        [30.1288961,59.5556948],
        [30.1300977,59.5543466],
        [30.1323293,59.5541726],
        [30.1328443,59.5556948],
        [30.1335309,59.5561515],
        [30.1339171,59.5567821],
        [30.134003,59.5574127],
        [30.1339601,59.5582824],
        [30.1338742,59.5588695],
        [30.134518,59.5592609],
        [30.1349042,59.5597609],
        [30.1362346,59.561696],
        [30.1373933,59.5634135],
        [30.1390241,59.5655657],
        [30.135505,59.5662831],
        [30.1339601,59.5641092],
        [30.1325868,59.5623482],
        [30.1310847,59.5604132],
        [30.1297544,59.558652],
        [30.1305268,59.557891],
        [30.1328443,59.5557166]],
        
        [[30.1245187,59.5598044],
         [30.1277019,59.5605948],
         [30.1297544,59.558652]],
         
        [[30.1274369,59.5569995],
         [30.1338742,59.5588695]],
          
        [[30.1349042,59.5597609],
         [30.1347401,59.5597686],
         [30.128689,59.5608665],
         [30.1277019,59.5605948],
         [30.1254918,59.5625624],
         [30.1275732,59.5659972],
         [30.1287534,59.5677037],
         [30.135505,59.5662831],
         [30.1388814,59.5707468],
         [30.1333668,59.5734527],
         [30.1308991,59.5710402],
         [30.1355769,59.5701599],
         [30.1368,59.5717031]],
         
        [[30.1390241,59.5655657],
         [30.1418027,59.5693697],
         [30.1388814,59.5707468]],
          
        [[30.1308991,59.5710402],
         [30.1287534,59.5677037]],
         
        [[30.1308991,59.5710402],
          [30.1264176,59.5722496],
          [30.1263746,59.5723909],
          [30.1258167,59.572543],
          [30.1255807,59.5725974],
          [30.1253447,59.5724235],
          [30.1255807,59.5723257],
          [30.1260742,59.572217],
          [30.126439,59.5722279]], 
          
        [[30.1261171,59.5636181],
          [30.1236495,59.5640964],
          [30.1211175,59.5645421],
          [30.1207098,59.5639225],
          [30.1203988,59.5635439]],
          
        [[30.1236495,59.5640964],
          [30.1226839,59.5628137],
          [30.1222119,59.5623028],
          [30.1219544,59.5621941]],
          
        [[30.1261171,59.5636181],
          [30.1361915,59.5616615]],
          
        [[30.1331459,59.5667903],
          [30.1320623,59.5654262],
          [30.1312576,59.5643283],
          [30.1306997,59.5636544],
          [30.1300775,59.5628283]],
          
        [[30.1318155,59.5651164],
          [30.1317404,59.5651218],
          [30.1299272,59.5655131],
          [30.1286612,59.5651381],
          [30.1286398,59.5649751],
          [30.1286827,59.5648066],
          [30.1287793,59.5646273],
          [30.1289617,59.5644696],
          [30.129144,59.5643773],
          [30.1310001,59.5640675]],
          
        [[30.1272558,59.5654099],
          [30.1286612,59.5651381],
          [30.128672,59.5650892],
          [30.1286612,59.5651381],
          [30.128672,59.5650729]],
          
        [[30.1355769,59.5701599],
          [30.1347585,59.5690974],
          [30.1331459,59.5667903]],
          
        [[30.1285198,59.5716922],
          [30.1259557,59.5694969],
          [30.1248613,59.5684699],
          [30.1287534,59.5677037]],
          
        [[30.1333668,59.5734527],
          [30.1314952,59.5743016],
          [30.1285198,59.5716922]],
          
        [[30.1373933,59.5634135],
          [30.1375801,59.5631131],
          [30.1378483,59.5627816],
          [30.1382453,59.5623848]],
          
        [[30.1373718,59.5633771],
          [30.131428,59.5645837]],
          
        [[30.1300775,59.5628283],
          [30.128689,59.5608665]],
                      
        [[30.1352449,59.5696916],
          [30.1377125,59.5692134]],
                   
        [[59.5685613, 30.1343973],
          [59.5680885, 30.1369186]]      
    ];
    
    // Drawing roads
    for (const roadLine of roadLines) {
      let lastPoint = undefined;
      
      for (const line of roadLines)
        for (const pair of line)
          [pair[0], pair[1]] = [pair[1], pair[0]];
      
      const line = L.polyline(roadLine, {});
      L.polylineDecorator(line, {
          	    patterns: [{
          	      offset: 0,
          	      repeat: 20,
          	      symbol: L.Symbol.marker({
          	        rotate: true,
          	        markerOptions: {
          	          icon: L.icon({
          	            iconUrl: 'http://files.softicons.com/download/system-icons/crystal-project-icons-by-everaldo-coelho/png/16x16/actions/1downarrow1.png',
          	            iconAnchor: [8, 8]
          	          })
          	        }
          	      })
          	    }]
          	  }).addTo(map);
    }
    
    // Signs
    const signs = [
            [59.55447, 30.13017, "secondary.png"],
            [59.55565, 30.12889, "rest40.png"],
            [59.55698, 30.12781, "main.png"],
            [59.5583, 30.12609, "rest40.png"],
            [59.5599, 30.12506, "oneway.png"],
            [59.55968, 30.12489, "main.png"],
            [59.56215, 30.12225, "main.png"],
            [59.56274, 30.12136, "rest40.png"],
            [59.56357, 30.12051, "main.png"],
            [59.56436, 30.12099, "oneway.png"],
            [59.56352, 30.12065, "forward.png"],
            [59.56455, 30.12155, "main_leftdown.png"],
            [59.56456, 30.12135, "main.png"],
            [59.56397, 30.12372, "secondary.png"],
            [59.56285, 30.12567, "rest30.png"],
            [59.56138, 30.12681, "rest40.png"],
            [59.55973, 30.12856, "rest40.png"],
            [59.55834, 30.13007, "rest40.png"],
            [59.55707, 30.1314, "rest40.png"],
            [59.55572, 30.1326, "main.png"],
            [59.55588, 30.13246, "main_7hours.png"],
            [59.55897, 30.13388, "main.png"],
            [59.55944, 30.13463, "rest40.png"],
            [59.55983, 30.13479, "main.png"],
            [59.56175, 30.13615, "rest40.png"],
            [59.56314, 30.13739, "main.png"],
            [59.56305, 30.13734, "main_rightdown.png"],
            [59.56543, 30.13909, "main.png"],
            [59.56922, 30.14184, "main.png"],
            [59.57053, 30.13953, "main.png"],
            [59.57344, 30.13355, "main.png"],
            [59.5743, 30.13163, "main.png"],
            [59.57392, 30.13225, "rest40.png"],
            [59.57177, 30.12847, "main.png"],
            [59.57347, 30.13059, "rest40.png"],
            [59.56812, 30.12606, "main.png"],
            [59.56848, 30.12513, "main.png"],
            [59.56409, 30.13423, "main.png"],
            [59.56633, 30.13579, "main.png"],
            [59.56462, 30.13169, "secondary.png"],
            [59.56399, 30.13050, "secondary.png"],
            [59.55431, 30.13223, "main.png"]
            ];
    
      // Drawing signs     
      for (const sign of signs) {
         const signMarker = L.icon({
                              iconUrl: 'Signs/' + sign[2],
                              shadowUrl: "",
                              iconSize: [30, 30],
                              shadowSize: [0, 0], // no shadow
                              iconAnchor: [0, -5], // some Google-to-OSM coordinate correction
                              shadowAnchor: [0, 0],
                              popupAnchor: [30, 15]  
                          });

         L.marker([sign[0], sign[1]], {icon: signMarker}).addTo(map);
      }
      
    
</script>